<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<title>Magic Beep</title>

	
     <link rel="stylesheet" type="text/css" href="../css/jquery.mobile-1.4.5.min.css"/>
     <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.icons.min.css"/>
       <!-- Fonts -->
    <link href='../css/opensans.css' rel='stylesheet' type='text/css'>
    <!-- Icons -->
    <link href="../css/ionicons.min.css" media="all" rel="stylesheet" type="text/css">
    <!-- Styles -->
    <link href="../css/keyframes.css" rel="stylesheet" type="text/css">
    <link href="../css/materialize.min.css" rel="stylesheet" type="text/css">
    <link href="../css/swiper.css" rel="stylesheet" type="text/css">
    <link href="../css/swipebox.min.css" rel="stylesheet" type="text/css">
    <link href="../css/style.css" rel="stylesheet" type="text/css">
     <link href="../css/custom.css" rel="stylesheet" type="text/css">
	<script>
	// Redirect console.log to Evothings Workbench.
	if (window.hyper && window.hyper.log) { console.log = hyper.log }
	</script>
	<script src="../libs/jquery/jquery.js"></script>
     <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
	<script type="text/javascript" src="../js/jquery.mobile-1.4.5.min.js"></script>
	<script src="../libs/evothings/evothings.js"></script>
	<script src="../libs/evothings/ui/ui.js"></script>

</head>

<body>
    <div data-role="page" id="mappa">
   <!-- Main Container -->
         <div class="m-scene"> 
         <!-- Sidebars -->
         <!-- Left Sidebar -->
        <ul id="slide-out-sei" class="side-nav collapsible">
        <li>
          <div class="sidenav-header primary-color">
            
             <div class="nav-avatar">
          
               <img class="avatar" src="../img/icona_menu.jpg" alt="">
              <div class="avatar-body">
                <h3>Magic Beep</h3>
                <p>Passeggia Aggiornato</p>
              </div>
            </div>
          </div>
        </li>
        <li><a href="../index.html#home" id="page_home" class="no-child" data-ajax="false"><i class="ion-android-home"></i>Home</a></li>
        <li><a href="../index.html#login" id="page_login"   class="no-child" data-ajax="false"><i class="ion-android-contact"></i>User/Login</a></li>
        <li><a href="../index.html#database" id="page_notizie"  class="no-child" data-ajax="false"><i class="ion-social-rss"></i>Notizie</a></li>
        <li><a href="#" class="no-child"><i class="ion-map"></i>Punti di interesse</a></li>
        <li><a href="../index.html#locali" id="page_locali" class="no-child" data-ajax="false"><i class="ion-android-apps"></i>Indoor navigation</a></li>
        <li><a href="../index.html#infoMvitalia" id="page_infoMv" class="no-child" data-ajax="false"><i class="ion-information-circled"></i>Info</a></li>
      </ul>
      <!-- End of Sidebars -->
        <!-- Page Content -->
      <div class="content page">

        <!-- Toolbar -->
        <div  class="toolbar primary-color">
           <span class="title"><a class="font_colore_titolo" id="page_home_titolo" href="../index.html#home" data-ajax="false">Magic Beep</a></span>
            <span class="SiLogin"></span><span><a class='logoutApp' href='#'><i style='font-size:15px !important;padding-left:15px;'  class='ion-log-out'></i></a></span>
          <div class="open-right" id="open-right-sei" data-activates="slide-out-sei">
            <i class="ion-android-menu"></i>
          </div>
        </div>
        <!-- Main Content -->
        <div class="animated fadeinup">
          <!-- Project Image -->
          <div id="map_canvas" style="width:100%;height:700px"></div>

</div>

          <!-- Footer -->
          <footer class="page-footer primary-color">
          <div class="container">
            <div class="row">
              <div class="col s12">
                <p class="center-align grey-text text-lighten-4">L'esperienza di Magic Beep a contatto con gli oggetti che ti circondano</p>
                <div class="center-align">
                <a href="#" onclick="window.open('https://www.facebook.com/MVitaliaWeb', '_system', 'location=yes'); return false;"> <i class="ion-social-facebook m-10 white-text"></i> </span>
                <a href="#" onclick="window.open('https://plus.google.com/u/0/b/107911645761848757909/+Mvitalia', '_system', 'location=yes'); return false;"> <i class=" ion-social-googleplus m-10 white-text"></i> </a>
                </div>
              </div>
            </div>
          </div>
          <div class="footer-copyright blue darken-1">
            <div class="container">
            2017 Magic Beep
            <a id="page_privacy_policy" class="grey-text text-lighten-4 right" href="../index.html#privacy_policy" data-ajax="false">Privacy Policy</a>
            </div>
          </div>
        </footer>
        </div> <!-- End of Main Contents -->
      
         
      </div> <!-- End of Page Content -->

    </div> <!-- End of Page Container --> 
      </div>  
<script>
 $(document).on("pagebeforeshow", "#mappa", function () { 
   var p = localStorage.getItem('login');
      if(p=='true')
     {
         $(".SiLogin").html("");  
         var li_dati="<span style='font-size:11px !important; color:#fff; padding-left:10px;'>"+localStorage.getItem('username')+"</span>";
         $(".SiLogin").append(li_dati);
          $(".SiLogin").show();
         $(".logoutApp").show();
     }
    });
// Inizio mappa
 $(document).on("pageshow", "#mappa", function () {
  GMap.init();
});

/* Style of the map */
		 var styles = [
		 {
			stylers: [
			  //{ "hue": "#f0f0f0" }
	
			]
		 }
		 ,{
			  "featureType": "water",
			  "stylers": [
				 { "hue": "#90B8FD" },
				 { "lightness": 0 },
				 { "visibility": "on" }
			  ]
			}
  
 
  
			
		 ,{
			  "featureType": "landscape",
			  "stylers": [
				 { "color": "#F0F0F0" },
				
			  ]
			}
		  ,{ 
		 "featureType": "administrative.country",
		 "elementType": "geometry",
		 "stylers": [
			{ "color": "#777777" },
			{ "weight": 1 }
		 
		 ]
		  }
		 ,{
			  "featureType": "administrative.country",
			  "elementType": "labels.text",
			  "stylers": [
				 { "visibility": "simplified" }
				 //{ "color": "#333333" }
			  ]
			},
		 
		 {
			featureType: "road",
			elementType: "geometry",
			stylers: [
			  { lightness: 100 },
			  { visibility: "simplified" }
			]
		 },{
			featureType: "road",
			elementType: "labels",
			stylers: [
			  { visibility: "off" }
			]
		 },{
				featureType: "poi",
				elementType: "labels",
				stylers: [
				  { visibility: "off" }
				]
			 }
	 
	
		  ];

var GMap = {
map: null,
infoWindow: null
};

GMap.closeInfoWindow = function() {
GMap.infoWindow.close();
};

GMap.openInfoWindow = function(marker, testo) {
var markerLatLng = marker.getPosition();
GMap.infoWindow.setContent(testo);
GMap.infoWindow.open(GMap.map, marker);
},

GMap.init = function() {
var centerLatLng = new google.maps.LatLng(44.70047,8.0362383);
var styledMap = new google.maps.StyledMapType(styles, {name: "titolo"});

var mapOptions = {
zoom: 11, 				//zoom level
center: centerLatLng, 		//center position
scrollwheel: false, 	//zoom when scroll disable
zoomControl: true, 		//show control zoom

mapTypeControlOptions: {
mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style'] 
}

};

GMap.map = new google.maps.Map(document.getElementById('map_canvas'),mapOptions);
GMap.infoWindow = new google.maps.InfoWindow();

//Associate the styled map with the MapTypeId and set it to display.
GMap.map.mapTypes.set('map_style', styledMap);
GMap.map.setMapTypeId('map_style');
google.maps.event.addListener(GMap.map, 'click', GMap.closeInfoWindow);

//loop dei progetti della zona 
var image = '../img/marker.png';
var marker = new Array();
var tendina = new Array();
  $.getJSON("http://magicbeep.mvclienti.com/webservices/sync_negozi.aspx", function (dati) {
                  
                    $.each(dati, function (i, name) {
                   
                          marker[i] = new google.maps.Marker({
                          map: GMap.map,
                          position: new google.maps.LatLng(name.latitudine, name.longitudine),
                          draggable: true,
                          icon: image
                          });
                          tendina[i]="<div><h5><b>"+name.nome+"</b></h5><hr><p class='tendina_mappa'>"+name.citta+" ("+name.provincia+")</p><p class='tendina_mappa'>"+name.indirizzo+" "+name.numero_civico+"</p>";
                          tendina[i]+="<div class='tendina_mappa'>"+name.descrizione+"</div><ul class='tendina_mappa'>";
                          
                          if (name.telefono != "")
                            tendina[i]+="<li>Tel.: <a href='tel:"+name.telefono+"'>"+name.telefono+"</a></li>";
                          
                          if (name.sito != "")  
                            tendina[i]+="<li>Web: <a href='"+name.sito+"' target='_blank'>"+name.sito+"</a></li>";
                          
                          tendina[i]+="</ul><br><br><a href='http://maps.google.com/maps?&daddr=" + name.latitudine + "," + name.longitudine +"'>Raggiungici</a></div>";

                          google.maps.event.addListener(marker[i], 'click', function() {
                          GMap.openInfoWindow(marker[i], tendina[i]);
                          });
                    });
					  // Funzione per la selezione dei beacon da ricercare dal db dell' app
                             
});
/*
var marker = new google.maps.Marker({
map: GMap.map,
position: new google.maps.LatLng(45.02045, 7.66473),
draggable: true,
icon: image
});

google.maps.event.addListener(marker, 'click', function() {
GMap.openInfoWindow(marker, '<strong>titolo</strong><br/><br/><a href="#" target="_blank">raggiungici</a>');
});

var marker2 = new google.maps.Marker({
map: GMap.map,
position: new google.maps.LatLng(44.9177489, 8.1323169),
draggable: true,
icon: image
});
var tedina = "<div><h5><b>MVitalia</b></h5><hr><p class='tendina_mappa'>Alba CN</p><p class='tendina_mappa'>Via vida N° 15</p><p class='tendina_mappa'>descrizione negozio</p><p><ul class='tendina_mappa'><li>Telefono: 335676567</li><li>sito web</li></ul></p></div>";
google.maps.event.addListener(marker2, 'click', function() {
GMap.openInfoWindow(marker2, tedina);
});*/

}





// Fine mappa 
</script> 
<script src="../app.js"></script>
<script type="text/javascript" src="../js/dati.js"></script>
<script src="../js/jquery.swipebox.min.js"></script>   
<script src="../js/materialize.min.js"></script> 
<script src="../js/swiper.min.js"></script>  
<script src="../js/jquery.mixitup.min.js"></script>
<script src="../js/masonry.min.js"></script>
<script src="../js/chart.min.js"></script>
<script src="../js/functions.js"></script>

</body>

</html>
